version: v1.0
name: Monorepo pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Backend Lint
    dependencies: []
    task:
      jobs:
        - name: Lint
          commands:
            - echo "Lint completed"
  - name: Frontend Lint
    dependencies:
      - Backend Lint
    task:
      jobs:
        - name: Lint
          commands:
            - echo "Lint completed"
  - name: Backend Build
    dependencies:
      - Backend Lint
    task:
      jobs:
        - name: Build
          commands:
            - sleep 10
            - echo "Build completed"
  - name: Frontend Build
    dependencies:
      - Frontend Lint
    task:
      jobs:
        - name: Build
          commands:
            - sleep 10
            - echo "Build completed"
  - name: Backend Unit tests
    dependencies:
      - Backend Build
    task:
      jobs:
        - name: Unit tests 1/3
          commands:
            - echo "Unit tests 1/3 completed"
        - name: Unit tests 2/3
          commands:
            - echo "Unit tests 2/3 completed"
        - name: Unit tests 3/3
          commands:
            - echo "Unit tests 3/3 completed"
  - name: Frontend Unit tests
    dependencies:
      - Frontend Build
    task:
      jobs:
        - name: Unit tests 1/2
          commands:
            - echo "Unit tests 1/2 completed"
        - name: Unit tests 2/2
          commands:
            - echo "Unit tests 2/2 completed"
        - name: 'Job #3'
          commands:
            - echo "here"
  - name: "E2E tests  \U0001F989 \U0001F989"
    dependencies:
      - Backend Unit tests
      - 'Block #14'
      - 'Block #15'
      - 'Block #17'
      - 'Block #18'
      - 'Block #19'
      - Frontend Unit tests
    task:
      jobs:
        - name: "Nightwatch \U0001F989 \U0001F989"
          commands:
            - "echo \"Nightwatch done \U0001F989 \U0001F989\""
      secrets:
        - name: '123'
      env_vars:
        - name: FOO_1
          value: BAR_1
      prologue:
        commands:
          - "echo \"Nightwatch done \U0001F989 \U0001F989\""
      agent:
        machine:
          type: e1-standard-2
          os_image: ubuntu1804
        containers:
          - name: main
            image: 'semaphoreci/ubuntu:18.04'
          - name: c2
            image: ''
    skip:
      when: branch != 'monorepo-4'
  - name: 'Block #8'
    dependencies:
      - Frontend Lint
    task:
      jobs:
        - name: 'Job #1'
          commands: []
  - name: 'Block #9'
    dependencies:
      - 'Block #8'
    task:
      jobs:
        - name: 'Job #1'
          commands: []
  - name: 'Block #10'
    dependencies:
      - 'Block #9'
    task:
      jobs:
        - name: 'Job #1'
          commands: []
  - name: 'Block #11'
    dependencies:
      - Frontend Unit tests
    task:
      jobs:
        - name: 'Job #1'
          commands: []
  - name: 'Block #12'
    dependencies:
      - 'Block #11'
    task:
      jobs:
        - name: 'Job #1'
          commands: []
  - name: 'Block #13'
    dependencies:
      - 'Block #12'
    task:
      jobs:
        - name: 'Job #1'
          commands: []
  - name: 'Block #14'
    dependencies:
      - Frontend Lint
    task:
      jobs:
        - name: 'Job #1'
          commands: []
  - name: 'Block #15'
    dependencies:
      - 'Block #14'
    task:
      jobs:
        - name: 'Job #1'
          commands: []
  - name: 'Block #16'
    dependencies:
      - 'Block #15'
    task:
      jobs:
        - name: 'Job #1'
          commands: []
  - name: 'Block #17'
    dependencies:
      - 'Block #16'
    task:
      jobs:
        - name: 'Job #1'
          commands: []
  - name: 'Block #18'
    dependencies:
      - 'Block #17'
    task:
      jobs:
        - name: 'Job #1'
          commands: []
  - name: 'Block #19'
    dependencies:
      - 'Block #18'
    task:
      jobs:
        - name: 'Job #1'
          commands: []
